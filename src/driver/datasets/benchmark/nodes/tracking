#!/usr/bin/env python

import rospy
from message_filters import ApproximateTimeSynchronizer, Subscriber
import threading

from zzz_perception_msgs.msg import TrackingBoxArray
from zzz_driver_datasets_benchmark.tracking import TrackingBenchmark

class TrackingBenchmarkNode(object):
    def __init__(self,
        ground_truth_topic="/kitti/tracklets",
        result_topic="/zzz/percetion/objects_tracked"):

        self._benchmark = TrackingBenchmark()
        self._synced_subscriber = ApproximateTimeSynchronizer([
            Subscriber(ground_truth_topic, TrackingBoxArray),
            Subscriber(result_topic, TrackingBoxArray)
        ], 5, 0.1)
        self._synced_subscriber.registerCallback(self.boxes_callback)

    def boxes_callback(self, gtbox, trbox):
        self._benchmark.add_frame(gtbox, trbox)

if __name__ == "__main__":

    rospy.init_node("tracking", log_level=rospy.DEBUG)
    node = TrackingBenchmarkNode()
    rospy.spin()
